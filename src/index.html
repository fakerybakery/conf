<!-- 
    Copyright 2020 Karan Shah.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<!DOCTYPE html>
<html>
<head>
    <meta content="width=device-width, initial-scale=1" name="viewport" />

    <title>HeavyHurdle</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel='stylesheet' href='assets/css/app.css' type="text/css">
    <link rel='icon' href='assets/img/ico.png'>

    <script src='/socket.io/socket.io.js'></script>
    <script type="module" src='assets/js/rtc.js'></script>
    <script type="module" src='assets/js/events.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/7.3.0/adapter.min.js" integrity="sha256-2qQheewaqnZlXJ3RJRghVUwD/3fD9HNqxh4C+zvgmF4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js'></script>
</head>
<body>
    <!-- Screen Recording Feature -->
    <div class="custom-modal hidden" id='recording-options-modal'>
        <div class="custom-modal-content">
            <div style="margin-bottom: 10px;">
                <span class="record-option" id='record-video' style="margin-right: 20%;">Record video</span>
                <span class="record-option" id='record-screen'>Record screen</span>
            </div>
            <button class="btn btn-outline-danger" id='closeModal'>Close</button>
        </div>
    </div>

    <!-- Header -->
    <nav class="navbar fixed-top bg-info rounded-0 d-print-none">
        <div class="text-white"><b>Heavy</b>Hurdle</div>
        <div class="pull-right room-comm" hidden>
            <button class="btn btn-sm rounded-0 btn-no-effect" style="padding: 0 !important; margin: 0 !important;" title="Hide Video">
                <i class="fa fa-video text-white user-toggler" id='toggle-video'></i>
            </button>
            <button class="btn btn-sm rounded-0 btn-no-effect" style="padding: 0 !important; margin: 0 !important;" title="Mute">
                <i class="fa fa-microphone-alt text-white user-toggler" id='toggle-mute'></i>
            </button>
            <button class="btn btn-sm rounded-0 btn-no-effect" style="padding: 0 !important; margin: 0 !important;" title="Share screen">
                <i class="fa fa-desktop text-white user-toggler" id='share-screen'></i>
            </button>
            <button class="btn btn-sm rounded-0 btn-no-effect" style="padding: 0 !important; margin: 0 !important;" title="Record">
                <i class="fa fa-dot-circle text-white user-toggler" id='record'></i>
            </button>
            <button class="btn btn-sm text-white pull-right btn-no-effect" style="padding: 0 !important; margin: 0 !important;">
                <i class="fa fa-comment user-toggler" id='toggle-chat-pane'></i> <span class="badge badge-danger very-small font-weight-lighter" id='new-chat-notification' hidden>New</span>
            </button>
            <button class="btn btn-sm rounded-0 btn-no-effect text-white" style="padding: 0 !important; margin: 0 !important;">
                <a href="pages/end.html" class="text-white text-decoration-none"><i class="fa fa-sign-out-alt text-white user-toggler" title="Leave"></i></a>
            </button>
        </div>
    </nav>

    <!-- Create Room -->
    <div class="container-fluid" id='room-create' style="margin-top: 50px;" hidden>
        <div class="row">
            <div class="col-12 h2 mt-5 text-center">New Conference</div>
        </div>
        <div class="row mt-2">
            <div class="col-12 text-center">
                <span class="form-text small text-danger" id='err-msg'></span>
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3">
                <label for="room-name">Room Name</label>
                <input type="text" id='room-name' class="form-control rounded-0" placeholder="Room Name">
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3">
                <label for="your-name">Your Name</label>
                <input type="text" id='your-name' class="form-control rounded-0" placeholder="Your Name">
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3">
                <button id='create-room' class="btn btn-block rounded-0 btn-info">Create Conference</button>
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3" id='room-created'></div>
        </div>
    </div>

    <!-- Join Room -->
    <div class="container-fluid" id='username-set' style="margin-top: 50px;" hidden>
        <div class="row">
            <div class="col-12 h4 mt-5 text-center">Your Name</div>
        </div>
        <div class="row mt-2">
            <div class="col-12 text-center">
                <span class="form-text small text-danger" id='err-msg-username'></span>
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3">
                <label for="username">Your Name</label>
                <input type="text" id='username' class="form-control rounded-0" placeholder="Your Name">
            </div>
            <div class="col-12 col-md-4 offset-md-4 mb-3">
                <button id='enter-room' class="btn btn-block rounded-0 btn-info">Enter Room</button>
            </div>
        </div>
    </div>

    <!-- In Conference  -->
    <div class="container-fluid room-comm" hidden>
        <div class="row">
            <video class="local-video mirror-mode" id='local' volume='0' autoplay muted></video>
        </div>

        <div class="row">
            <div class="col-md-12 main" id='main-section'>
                <div class="row mt-2 mb-2" id='videos' style="border: 1px solid black; overflow-y: scroll; overflow-x: hidden; max-width: 30vw !important;"></div>
            </div>

            <!-- Chat Panel -->
            <div class="col-md-3 chat-col d-print-none mb-2 bg-info" id='chat-pane' hidden>
                <div class="row">
                    <div class="col-12 text-center h2 mb-3" style="padding-bottom: 20px; border-bottom: 1px solid white;">CHAT</div>
                </div>
                <div id='chat-messages'></div>
                <div class="row">
                    <textarea id='chat-input' class="form-control rounded-0 chat-box border-info" rows='3' placeholder="Enter message here"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div id="new-user-manager">
        <!-- Auto-Generates When User Joins -->
    </div>

    <script>
        function copier (roomLink) {
            var dummy = document.createElement('input'),
                        text = roomLink;
            document.body.appendChild(dummy);
            dummy.value = roomLink;
            dummy.select();
            document.execCommand('copy');
            document.body.removeChild(dummy);
        }

        function new_user (userInfo) {
            document.getElementById('new-user-manager').innerHTML += "<div class='new-user-join' id='" + userInfo.socketId + "'> " + userInfo.username + " has joined the call</div>";
            fadeAction();
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script>
        function fadeAction () {
            $(".new-user-join").fadeOut(5000, function() {
                $(this).remove();
            });
        }
    </script>
</body>
</html>